<!DOCTYPE html>
<html>
<head>
    <title>ViciDial Proxy Frame</title>
</head>
<body>
    <script>
        // This iframe acts as a proxy to make HTTP requests from HTTP context
        
        window.addEventListener('message', async function(event) {
            // Only accept messages from our parent
            if (event.origin !== window.location.origin) return;
            
            const { action, params } = event.data;
            
            if (action === 'vicidial-request') {
                try {
                    // Build URL
                    const baseUrl = 'http://204.13.233.29:8889/';
                    const queryString = new URLSearchParams(params).toString();
                    const url = baseUrl + '?' + queryString;
                    
                    // Make request
                    const response = await fetch(url);
                    const text = await response.text();
                    
                    // Send response back
                    event.source.postMessage({
                        action: 'vicidial-response',
                        success: true,
                        data: text
                    }, event.origin);
                } catch (error) {
                    event.source.postMessage({
                        action: 'vicidial-response',
                        success: false,
                        error: error.message
                    }, event.origin);
                }
            }
        });
        
        // Signal ready
        if (window.parent !== window) {
            window.parent.postMessage({ action: 'proxy-ready' }, '*');
        }
    </script>
</body>
</html>